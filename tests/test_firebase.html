<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teste Firebase - Quest4Couple</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .status {
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .warning { background: #fff3cd; color: #856404; }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #5568d3;
    }
    #console {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  
  <h1>üî• Teste Firebase - Quest4Couple</h1>
  
  <div class="test-box">
    <h2>1. Verifica√ß√£o Firebase SDK</h2>
    <div id="firebase-check" class="status warning">Verificando...</div>
  </div>

  <div class="test-box">
    <h2>2. Verifica√ß√£o Auth</h2>
    <div id="auth-check" class="status warning">Verificando...</div>
  </div>

  <div class="test-box">
    <h2>3. Verifica√ß√£o Firestore</h2>
    <div id="firestore-check" class="status warning">Verificando...</div>
  </div>

  <div class="test-box">
    <h2>4. Verifica√ß√£o Google Provider</h2>
    <div id="google-check" class="status warning">Verificando...</div>
  </div>

  <div class="test-box">
    <h2>5. Teste Google Sign In</h2>
    <button onclick="testGoogleSignIn()">Testar Google Login</button>
    <button onclick="testEmailSignUp()">Testar Email Signup</button>
    <div id="test-result" style="margin-top: 10px;"></div>
  </div>

  <div class="test-box">
    <h2>Console Output</h2>
    <div id="console"></div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <!-- App Scripts -->
  <script src="js/firebase-config.js"></script>

  <script>
    // Capturar console.log
    const consoleDiv = document.getElementById('console');
    const originalLog = console.log;
    const originalError = console.error;
    
    function addToConsole(type, ...args) {
      const message = args.map(arg => 
        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
      ).join(' ');
      
      const timestamp = new Date().toLocaleTimeString();
      consoleDiv.innerHTML += `[${timestamp}] ${type}: ${message}\n`;
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }
    
    console.log = function(...args) {
      originalLog.apply(console, args);
      addToConsole('LOG', ...args);
    };
    
    console.error = function(...args) {
      originalError.apply(console, args);
      addToConsole('ERROR', ...args);
    };

    // Testes
    window.addEventListener('load', () => {
      console.log('üîµ P√°gina carregada, iniciando testes...');
      
      // Test 1: Firebase SDK
      setTimeout(() => {
        const firebaseCheck = document.getElementById('firebase-check');
        if (typeof firebase !== 'undefined') {
          firebaseCheck.className = 'status success';
          firebaseCheck.textContent = '‚úÖ Firebase SDK carregado: v' + firebase.SDK_VERSION;
          console.log('‚úÖ Firebase SDK OK');
        } else {
          firebaseCheck.className = 'status error';
          firebaseCheck.textContent = '‚ùå Firebase SDK n√£o carregado';
          console.error('‚ùå Firebase SDK FAIL');
        }
      }, 500);

      // Test 2: Auth
      setTimeout(() => {
        const authCheck = document.getElementById('auth-check');
        if (typeof auth !== 'undefined' && auth) {
          authCheck.className = 'status success';
          authCheck.textContent = '‚úÖ Firebase Auth inicializado';
          console.log('‚úÖ Auth OK:', auth);
        } else {
          authCheck.className = 'status error';
          authCheck.textContent = '‚ùå Firebase Auth n√£o inicializado';
          console.error('‚ùå Auth FAIL');
        }
      }, 1000);

      // Test 3: Firestore
      setTimeout(() => {
        const firestoreCheck = document.getElementById('firestore-check');
        if (typeof db !== 'undefined' && db) {
          firestoreCheck.className = 'status success';
          firestoreCheck.textContent = '‚úÖ Firestore inicializado';
          console.log('‚úÖ Firestore OK:', db);
        } else {
          firestoreCheck.className = 'status error';
          firestoreCheck.textContent = '‚ùå Firestore n√£o inicializado';
          console.error('‚ùå Firestore FAIL');
        }
      }, 1500);

      // Test 4: Google Provider
      setTimeout(() => {
        const googleCheck = document.getElementById('google-check');
        if (typeof googleProvider !== 'undefined' && googleProvider) {
          googleCheck.className = 'status success';
          googleCheck.textContent = '‚úÖ Google Provider configurado';
          console.log('‚úÖ Google Provider OK:', googleProvider);
        } else {
          googleCheck.className = 'status error';
          googleCheck.textContent = '‚ùå Google Provider n√£o configurado';
          console.error('‚ùå Google Provider FAIL');
        }
      }, 2000);
    });

    // Test Google Sign In
    async function testGoogleSignIn() {
      const resultDiv = document.getElementById('test-result');
      resultDiv.innerHTML = '<div class="status warning">Testando Google Sign In...</div>';
      
      console.log('üîµ Iniciando teste Google Sign In...');
      
      try {
        console.log('üîµ Chamando auth.signInWithPopup...');
        const result = await auth.signInWithPopup(googleProvider);
        
        console.log('‚úÖ Sucesso! User:', result.user);
        resultDiv.innerHTML = `
          <div class="status success">
            ‚úÖ Login Google bem-sucedido!<br>
            Email: ${result.user.email}<br>
            UID: ${result.user.uid}
          </div>
        `;
      } catch (error) {
        console.error('‚ùå Erro:', error);
        resultDiv.innerHTML = `
          <div class="status error">
            ‚ùå Erro no login Google<br>
            Code: ${error.code}<br>
            Message: ${error.message}
          </div>
        `;
      }
    }

    // Test Email Sign Up
    async function testEmailSignUp() {
      const resultDiv = document.getElementById('test-result');
      const email = 'teste' + Date.now() + '@example.com';
      const password = 'teste123';
      
      resultDiv.innerHTML = '<div class="status warning">Testando Email Sign Up...</div>';
      console.log('üîµ Testando signup com:', email);
      
      try {
        const result = await auth.createUserWithEmailAndPassword(email, password);
        console.log('‚úÖ Sucesso! User:', result.user);
        
        resultDiv.innerHTML = `
          <div class="status success">
            ‚úÖ Signup bem-sucedido!<br>
            Email: ${result.user.email}<br>
            UID: ${result.user.uid}
          </div>
        `;
      } catch (error) {
        console.error('‚ùå Erro:', error);
        resultDiv.innerHTML = `
          <div class="status error">
            ‚ùå Erro no signup<br>
            Code: ${error.code}<br>
            Message: ${error.message}
          </div>
        `;
      }
    }
  </script>

</body>
</html>
