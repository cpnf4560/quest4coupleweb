<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- âœ… Cache Busting - ForÃ§a refresh no Chrome mobile -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <title>Quest4Couple - Sistema para Casais ğŸ’•</title>
  
  <!-- Favicons -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico?v=3">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=3">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=3">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=3">
  <link rel="manifest" href="/site.webmanifest?v=3">
    <!-- CSS Modules -->
  <link rel="stylesheet" href="css/main.css?v=20241120">
  <link rel="stylesheet" href="css/themes.css?v=20241120">
  <link rel="stylesheet" href="css/questions.css?v=20241120">
  
  <!-- Microsoft Clarity -->
  <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "u8hwuw3ixs");
  </script>
</head>
<body>

<!-- Age Verification Modal -->
<div class="modal-overlay active" id="ageModal">
  <div class="age-modal">
    <div class="age-modal-icon">ğŸ”</div>
    <h2 data-i18n="app.ageModal.title">VerificaÃ§Ã£o de Idade</h2>
    <p data-i18n-html="app.ageModal.question">Este site contÃ©m conteÃºdo adulto.<br>Tens 18 anos ou mais?</p>
    
    <div class="age-buttons">
      <button class="age-btn age-btn-yes" onclick="confirmAge(true)" data-i18n="app.ageModal.yes">
        âœ“ Sim, tenho +18
      </button>
      <button class="age-btn age-btn-no" onclick="confirmAge(false)" data-i18n="app.ageModal.no">
        âœ— NÃ£o, sou menor
      </button>
    </div>
    
    <div class="age-warning" data-i18n="app.ageModal.warning">
      âš ï¸ Ao confirmar, declaras que tens idade legal para aceder a este conteÃºdo.
    </div>
  </div>
</div>

<!-- Header -->
<div class="header">
  <!-- Logo e TÃ­tulo (Centro) -->
  <div class="logo-section">
    <a href="index.html">
      <img src="./assets/logo.png" alt="Quest4Couple Logo" class="logo" onerror="this.src='./logo.png'; this.onerror=null;">
    </a>
    <h1>Quest4Couple</h1>
    <p class="tagline" data-i18n="home.subtitle">Descubram-se juntos ğŸ’•</p>
  </div>
    <!-- User Section (Canto Superior Direito) -->  <div class="user-section-top">
    <span class="user-info" id="userInfo">
      ğŸ‘¤ <span id="currentUserName" data-i18n="common.loading">Carregando...</span>
    </span>
    
    <!-- âœ… NOVO: Indicador de sincronizaÃ§Ã£o -->
    <span id="syncStatus" class="sync-status" style="display: none;">
      <span class="sync-icon">âœ…</span>
      <span class="sync-text" data-i18n="app.saved">Guardado</span>
    </span>
    
    <button class="btn btn-primary" onclick="window.location.href='relatorio.html'" title="Ver RelatÃ³rio">
      <span>ğŸ“Š</span> <span data-i18n="header.report">RelatÃ³rio</span>
    </button>
    
    <button class="btn btn-dashboard" onclick="window.location.href='dashboard.html'" title="Voltar ao Dashboard">
      <span>ğŸ“Š</span> <span data-i18n="header.dashboard">Dashboard</span>
    </button>
    <button class="btn btn-logout" onclick="logout()" title="Sair">
      <span>ğŸšª</span> <span data-i18n="header.logout">Sair</span>
    </button>
  </div>
  
  <div class="free-badge-small" data-i18n="home.badge.free">
    âœ¨ 100% Gratuito
  </div>
    <!-- Compare Section -->
  <div id="compareSection" style="display: none;">
    <h3>ğŸ” Comparar Respostas do Casal</h3>
    
    <div style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border-radius: 15px; border-left: 5px solid #667eea;">
      <div style="font-size: 1.5em; margin-bottom: 10px;">âœ¨ Nova PÃ¡gina de RelatÃ³rio!</div>
      <p style="margin-bottom: 15px; font-size: 1.05em;">Para uma melhor experiÃªncia, use a pÃ¡gina dedicada do relatÃ³rio:</p>
      <a href="relatorio.html" style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 10px; font-weight: 700; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        ğŸ¯ Ir para PÃ¡gina do RelatÃ³rio
      </a>
    </div>
    
    <details>
      <summary style="cursor: pointer; font-weight: 700; padding: 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;">
        ğŸ“‹ Ou gerar relatÃ³rio aqui (legado)
      </summary>
      
      <div style="margin-top: 15px;">
        <div>
          <label>ğŸ“ Carregar o VOSSO ficheiro .q4c:</label>
          <input type="file" id="myFile" accept=".q4c">
        </div>
        <div>
          <label>ğŸ“ Carregar ficheiro .q4c do/a parceiro/a:</label>
          <input type="file" id="partnerFile" accept=".q4c">
        </div>
        <div>
          <label>ğŸ”‘ CÃ³digo de seguranÃ§a:</label>
          <input type="password" id="securityCode" placeholder="CÃ³digo utilizado...">
        </div>
        <button class="btn" onclick="compareEncryptedAnswers()">ğŸ¯ Gerar RelatÃ³rio</button>
        
        <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px; font-size: 11px;">
          ğŸ’¡ <strong>Como funciona:</strong><br>
          1. Cada pessoa responde e gera um ficheiro .q4c<br>
          2. Partilham os ficheiros entre si<br>
          3. Carregam ambos aqui e veem o relatÃ³rio<br>
          4. Usem o mesmo cÃ³digo de seguranÃ§a
        </div>
      </div>
    </details>
  </div>
  
  <div id="compatibilityReport" style="display: none;"></div>
</div>

<!-- Couple Configuration -->
<div class="couple-config-section" id="coupleConfig">
  <div class="couple-config-header">
    <h2><span>ğŸ‘«</span> <span data-i18n="app.coupleConfig.title">ConfiguraÃ§Ã£o do Casal</span></h2>
    <p data-i18n="app.coupleConfig.subtitle">Seleciona o tipo de relaÃ§Ã£o para personalizar as perguntas</p>
  </div>
  
  <div class="couple-types-grid">
    <div class="couple-type-card" onclick="selectCoupleType('hetero')">
      <span class="couple-type-icon">ğŸ‘¨â€â¤ï¸â€ğŸ‘©</span>
      <h3 data-i18n="app.coupleConfig.hetero">Homem + Mulher</h3>
      <p data-i18n="app.coupleConfig.heteroDesc">Casal heterossexual</p>
    </div>
    
    <div class="couple-type-card" onclick="selectCoupleType('lesbian')">
      <span class="couple-type-icon">ğŸ‘©â€â¤ï¸â€ğŸ‘©</span>
      <h3 data-i18n="app.coupleConfig.lesbian">Mulher + Mulher</h3>
      <p data-i18n="app.coupleConfig.lesbianDesc">Casal lÃ©sbico</p>
    </div>
    
    <div class="couple-type-card" onclick="selectCoupleType('gay')">
      <span class="couple-type-icon">ğŸ‘¨â€â¤ï¸â€ğŸ‘¨</span>
      <h3 data-i18n="app.coupleConfig.gay">Homem + Homem</h3>
      <p data-i18n="app.coupleConfig.gayDesc">Casal gay</p>
    </div>
    
    <div class="couple-type-card" onclick="selectCoupleType('other')">
      <span class="couple-type-icon">ğŸŒˆ</span>
      <h3 data-i18n="app.coupleConfig.other">Outro / Todas</h3>
      <p data-i18n="app.coupleConfig.otherDesc">NÃ£o-binÃ¡rio ou ver tudo</p>
    </div>
  </div>
  
  <button class="continue-btn" id="continueBtn" onclick="continueToThemes()" disabled data-i18n="app.coupleConfig.continue">
    Continuar â†’
  </button>
  
  <div class="skip-config">
    <a href="#" onclick="skipConfig(); return false;" data-i18n="app.coupleConfig.skip">Pular configuraÃ§Ã£o</a>
  </div>
</div>

<!-- Theme Selection Grid -->
<div id="themesView" class="themes-grid" style="display: none;">  <div class="theme-card" onclick="showTheme('romantico')">
    <div class="theme-card-header romantico">
      <span class="theme-icon">ğŸ’</span>
      <h3 data-i18n="app.packs.romanticTitle">RomÃ¢ntico & Fantasias</h3>
      <p class="theme-description" data-i18n="app.themes.romanticDesc">Velas, seduÃ§Ã£o, conexÃ£o profunda e momentos especiais a dois</p>
    </div>    <div class="theme-card-footer">
      <div class="footer-content">
        <span class="question-count">ğŸ“ 50 <span data-i18n="app.themes.questions">perguntas</span></span>
        <span class="theme-free">âœ¨ <span data-i18n="app.themes.free">GrÃ¡tis</span></span>
      </div>      <div class="theme-progress">
        <div class="theme-progress-container">
          <div class="theme-progress-bar"></div>
        </div>
        <div class="theme-progress-text">0 <span data-i18n="app.themes.of">de</span> 50 <span data-i18n="app.themes.answered">respondidas</span></div>
      </div>
    </div>
  </div>  <div class="theme-card" onclick="showTheme('experiencia')">
    <div class="theme-card-header experiencia">
      <img src="./assets/exp2.png" alt="ExperiÃªncia a 2" class="theme-icon-img">
      <h3 data-i18n="app.packs.experienceTitle">ExperiÃªncia a 2</h3>
      <p class="theme-description" data-i18n="app.themes.experienceDesc">Aventuras, locais diferentes e novas experiÃªncias juntos</p>
      <p class="theme-spacer">&nbsp;</p>
    </div>
    <div class="theme-card-footer">
      <div class="footer-content">
        <span class="question-count">ğŸ“ 50 <span data-i18n="app.themes.questions">perguntas</span></span>
        <span class="theme-free">âœ¨ <span data-i18n="app.themes.free">GrÃ¡tis</span></span>
      </div>      <div class="theme-progress">
        <div class="theme-progress-container">
          <div class="theme-progress-bar"></div>
        </div>
        <div class="theme-progress-text">0 <span data-i18n="app.themes.of">de</span> 50 <span data-i18n="app.themes.answered">respondidas</span></div>
      </div>
    </div>
  </div>  <div class="theme-card" onclick="showTheme('pimentinha')">
    <div class="theme-card-header pimentinha">
      <img src="./assets/pimentinha.png?v=1" alt="Pimentinha" class="theme-icon-img">
      <h3 data-i18n="app.packs.spicyTitle">Pimentinha</h3>
      <p class="theme-description" data-i18n="app.themes.spicyDesc">Adicione tempero, provocaÃ§Ã£o e jogos sensuais</p>
      <p class="theme-spacer">&nbsp;</p>
    </div>
    <div class="theme-card-footer">
      <div class="footer-content">
        <span class="question-count">ğŸ“ 50 perguntas</span>
        <span class="theme-free">âœ¨ GrÃ¡tis</span>
      </div>      <div class="theme-progress">
        <div class="theme-progress-container">
          <div class="theme-progress-bar"></div>
        </div>
        <div class="theme-progress-text">0 <span data-i18n="app.themes.of">de</span> 50 <span data-i18n="app.themes.answered">respondidas</span></div>
      </div>
    </div>
  </div>  <div class="theme-card" onclick="showTheme('poliamor')">
    <div class="theme-card-header poliamor">
      <img src="./assets/poliamor.png" alt="Poliamor" class="theme-icon-img">
      <h3 data-i18n="app.packs.polyamoryTitle">Poliamor</h3>
      <p class="theme-description" data-i18n="app.themes.polyamoryDesc">MÃºltiplos parceiros, swing e experiÃªncias em grupo</p>
      <p class="theme-spacer">&nbsp;</p>
    </div>
    <div class="theme-card-footer">
      <div class="footer-content">
        <span class="question-count">ğŸ“ 60 <span data-i18n="app.themes.questions">perguntas</span></span>
        <span class="theme-free">âœ¨ <span data-i18n="app.themes.free">GrÃ¡tis</span></span>
      </div>      <div class="theme-progress">
        <div class="theme-progress-container">
          <div class="theme-progress-bar"></div>
        </div>
        <div class="theme-progress-text">0 <span data-i18n="app.themes.of">de</span> 60 <span data-i18n="app.themes.answered">respondidas</span></div>
      </div>
    </div>
  </div><div class="theme-card" onclick="showTheme('kinks')">
    <div class="theme-card-header kinks">
      <img src="./assets/fetiches.png" alt="Kinks & Fetiches" class="theme-icon-img">
      <h3 data-i18n="app.packs.fetishesTitle">Kinks & Fetiches</h3>
      <p class="theme-description" data-i18n="app.themes.fetishesDesc">Fetiches especÃ­ficos, prÃ¡ticas avanÃ§adas e preferÃªncias Ãºnicas</p>
      <p class="theme-spacer">&nbsp;</p>
    </div>
    <div class="theme-card-footer">
      <div class="footer-content">
        <span class="question-count">ğŸ“ 90 <span data-i18n="app.themes.questions">perguntas</span></span>
        <span class="theme-free">âœ¨ <span data-i18n="app.themes.free">GrÃ¡tis</span></span>      </div>
      <div class="theme-progress">
        <div class="theme-progress-container">
          <div class="theme-progress-bar"></div>
        </div>
        <div class="theme-progress-text">0 <span data-i18n="app.themes.of">de</span> 90 <span data-i18n="app.themes.answered">respondidas</span></div>
      </div>    </div>  </div>
</div>

<!-- Controls - Moved below themes -->
<div class="controls-bottom" id="mainControls">
  <button class="btn" onclick="saveAnswers()"><span>ğŸ’¾</span> <span data-i18n="app.controls.save">Guardar</span></button>
  <button class="btn btn-load" onclick="showLoadModal()"><span>ğŸ“‚</span> <span data-i18n="app.controls.load">Carregar</span></button>
  <button class="btn btn-import" onclick="showImportModal()"><span>ğŸ“¥</span> <span data-i18n="app.controls.import">Importar</span></button>
  <button class="btn" onclick="showCompareSection()"><span>ğŸ”€</span> <span data-i18n="app.controls.compare">Comparar</span></button>
  <button class="btn btn-secondary" onclick="generatePDF()"><span>ğŸ“„</span> <span data-i18n="app.controls.pdf">PDF</span></button>
  <button class="btn btn-secondary" onclick="sendByEmail()"><span>ğŸ“§</span> <span data-i18n="app.controls.email">E-mail</span></button>
</div>

<!-- Pack Navigation Sidebar -->
<div class="pack-nav-sidebar hidden" id="packNavSidebar">
  <button class="pack-nav-toggle" onclick="togglePackNav()" title="NavegaÃ§Ã£o entre Packs">
    <span class="toggle-icon">ğŸ«¶</span>
  </button>
  <div class="pack-nav-content">
    <h3 data-i18n="app.sidebar.navigate">Navegar Packs</h3>    <button class="pack-nav-item romantico" onclick="showTheme('romantico')">
      <span class="nav-emoji">ğŸ’</span>
      <span class="nav-label" data-i18n="app.packs.romantic">RomÃ¢ntico</span>
    </button><button class="pack-nav-item experiencia" onclick="showTheme('experiencia')">
      <span class="nav-emoji">ğŸ”¥</span>
      <span class="nav-label" data-i18n="app.packs.experience">ExperiÃªncia</span>
    </button>
    <button class="pack-nav-item pimentinha" onclick="showTheme('pimentinha')">
      <span class="nav-emoji">ğŸŒ¶ï¸</span>
      <span class="nav-label" data-i18n="app.packs.spicy">Pimentinha</span>
    </button>
    <button class="pack-nav-item poliamor" onclick="showTheme('poliamor')">
      <span class="nav-emoji">ğŸ”€</span>
      <span class="nav-label" data-i18n="app.packs.polyamory">Poliamor</span>
    </button>
    <button class="pack-nav-item kinks" onclick="showTheme('kinks')">
      <span class="nav-emoji">â›“ï¸</span>
      <span class="nav-label" data-i18n="app.packs.fetishes">Fetiches</span>
    </button>
    <button class="pack-nav-back" onclick="backToThemes()" data-i18n="app.sidebar.backToThemes">
      â† Voltar aos Temas
    </button>
  </div>
</div>

<!-- Pack RomÃ¢ntico -->
<div class="pack romantico" id="pack-romantico">
  <div class="pack-header">
    <h2><span>ğŸ’</span> <span data-i18n="app.packs.romanticTitle">RomÃ¢ntico & Fantasias</span></h2>
    <button class="back-btn" onclick="backToThemes()" data-i18n="app.backButton">â† Voltar</button>
  </div>
  
  <!-- Guia de Respostas -->
  <div class="response-guide">
    <h3><span>ğŸ“–</span> <span data-i18n="app.guide.title">Guia de Respostas</span></h3>
    <p><strong data-i18n="app.guide.beHonest">Sejam honestos e claros nas vossas respostas!</strong></p>
    <div class="guide-options">
      <div class="guide-option">
        <span class="guide-emoji">ğŸ˜</span>
        <strong data-i18n="app.guide.please">Por favor!</strong>
        <p data-i18n-html="app.guide.pleaseDesc">Usem apenas para algo que <u>realmente desejam muito</u>. Isto criarÃ¡ prioridades no relatÃ³rio!</p>
      </div>
      <div class="guide-option">
        <span class="guide-emoji">ğŸ‘</span>
        <strong data-i18n="app.guide.yup">Yup</strong>
        <p data-i18n="app.guide.yupDesc">Estou aberto/a, gostaria de experimentar.</p>
      </div>
      <div class="guide-option">
        <span class="guide-emoji">ğŸ˜‘</span>
        <strong data-i18n="app.guide.meh">Meh...</strong>
        <p data-i18n-html="app.guide.mehDesc">NÃ£o me interessa ou nÃ£o me sinto confortÃ¡vel. Estas questÃµes <u>nÃ£o aparecerÃ£o</u> no relatÃ³rio, EXCETO se o/a parceiro/a responder "Por favor!" (para reflexÃ£o do casal).</p>
      </div>
      <div class="guide-option">
        <span class="guide-emoji">ğŸ¤”</span>
        <strong data-i18n="app.guide.maybe">Talvez</strong>
        <p data-i18n="app.guide.maybeDesc">Preciso pensar melhor, nÃ£o tenho certeza.</p>
      </div>
    </div>    <button class="btn-understand" onclick="this.parentElement.style.display='none'" data-i18n="app.guide.understand">âœ“ Entendi, vamos comeÃ§ar!</button>
  </div>
    <div class="pack-content" id="pack-romantico-questions"></div>
  <div class="pack-footer">
    <button class="btn-add-custom" onclick="openCustomQuestionModal('romantico')" data-i18n="app.packFooter.addCustom">
      â• Adicionar Pergunta Personalizada
    </button>
    <button class="btn-save-pack" onclick="saveAnswers()" data-i18n="app.packFooter.saveAnswers">
      ğŸ’¾ Guardar Respostas
    </button>
    <p class="save-hint" data-i18n="app.packFooter.saveHint">ğŸ’¡ NÃ£o Ã© obrigatÃ³rio, mas recomendamos guardar para continuar depois ou evitar perder o progresso</p>
  </div>
</div>

<!-- Pack ExperiÃªncia -->
<div class="pack experiencia" id="pack-experiencia">
  <div class="pack-header">
    <h2><span>ğŸŒ</span> <span data-i18n="app.packs.experienceTitle">ExploraÃ§Ã£o e Aventura a Dois</span></h2>
    <button class="back-btn" onclick="backToThemes()" data-i18n="app.backButton">â† Voltar</button>
  </div>  <div class="pack-content" id="pack-experiencia-questions"></div>
  <div class="pack-footer">
    <button class="btn-add-custom" onclick="openCustomQuestionModal('experiencia')" data-i18n="app.packFooter.addCustom">
      â• Adicionar Pergunta Personalizada
    </button>
    <button class="btn-save-pack" onclick="saveAnswers()" data-i18n="app.packFooter.saveAnswers">
      ğŸ’¾ Guardar Respostas
    </button>
    <p class="save-hint" data-i18n="app.packFooter.saveHint">ğŸ’¡ NÃ£o Ã© obrigatÃ³rio, mas recomendamos guardar para continuar depois ou evitar perder o progresso</p>
  </div>
</div>

<!-- Pack Pimentinha -->
<div class="pack pimentinha" id="pack-pimentinha">
  <div class="pack-header">
    <h2><span>ğŸ”¥</span> <span data-i18n="app.packs.spicyTitle">Pimentinha</span></h2>
    <button class="back-btn" onclick="backToThemes()" data-i18n="app.backButton">â† Voltar</button>
  </div>  <div class="pack-content" id="pack-pimentinha-questions"></div>
  <div class="pack-footer">
    <button class="btn-add-custom" onclick="openCustomQuestionModal('pimentinha')" data-i18n="app.packFooter.addCustom">
      â• Adicionar Pergunta Personalizada
    </button>
    <button class="btn-save-pack" onclick="saveAnswers()" data-i18n="app.packFooter.saveAnswers">
      ğŸ’¾ Guardar Respostas
    </button>
    <p class="save-hint" data-i18n="app.packFooter.saveHint">ğŸ’¡ NÃ£o Ã© obrigatÃ³rio, mas recomendamos guardar para continuar depois ou evitar perder o progresso</p>
  </div>
</div>

<!-- Pack Poliamor -->
<div class="pack poliamor" id="pack-poliamor">
  <div class="pack-header">
    <h2><span>ğŸ’</span> <span data-i18n="app.packs.polyamoryTitle">Poliamor & MÃºltiplos Parceiros</span></h2>
    <button class="back-btn" onclick="backToThemes()" data-i18n="app.backButton">â† Voltar</button>
  </div>  <div class="pack-content" id="pack-poliamor-questions"></div>
  <div class="pack-footer">
    <button class="btn-add-custom" onclick="openCustomQuestionModal('poliamor')" data-i18n="app.packFooter.addCustom">
      â• Adicionar Pergunta Personalizada
    </button>
    <button class="btn-save-pack" onclick="saveAnswers()" data-i18n="app.packFooter.saveAnswers">
      ğŸ’¾ Guardar Respostas
    </button>
    <p class="save-hint" data-i18n="app.packFooter.saveHint">ğŸ’¡ NÃ£o Ã© obrigatÃ³rio, mas recomendamos guardar para continuar depois ou evitar perder o progresso</p>
  </div>
</div>

<!-- Pack Fetiches -->
<div class="pack kinks" id="pack-kinks">
  <div class="pack-header">
    <h2><span>â›“ï¸</span> <span data-i18n="app.packs.fetishesTitle">Kinks & Fetiches</span></h2>
    <button class="back-btn" onclick="backToThemes()" data-i18n="app.backButton">â† Voltar</button>
  </div>  <div class="pack-content" id="pack-kinks-questions"></div>
  <div class="pack-footer">
    <button class="btn-add-custom" onclick="openCustomQuestionModal('kinks')" data-i18n="app.packFooter.addCustom">
      â• Adicionar Pergunta Personalizada
    </button>
    <button class="btn-save-pack" onclick="saveAnswers()" data-i18n="app.packFooter.saveAnswers">
      ğŸ’¾ Guardar Respostas
    </button>
    <p class="save-hint" data-i18n="app.packFooter.saveHint">ğŸ’¡ NÃ£o Ã© obrigatÃ³rio, mas recomendamos guardar para continuar depois ou evitar perder o progresso</p>
  </div>
</div>

<!-- Custom Question Modal -->
<div class="modal-overlay" id="customQuestionModal">
  <div class="custom-question-modal">
    <div class="custom-modal-header">
      <h2 data-i18n="app.modals.customQuestion.title">âœï¸ Adicionar Pergunta Personalizada</h2>
      <button class="modal-close" onclick="closeCustomQuestionModal()">âœ•</button>
    </div>
    
    <div class="custom-modal-body">
      <label for="customQuestionText" data-i18n="app.modals.customQuestion.label">ğŸ“ Pergunta:</label>
      <textarea id="customQuestionText" data-i18n-placeholder="app.modals.customQuestion.placeholder" placeholder="Escreve a tua pergunta personalizada aqui..." rows="3"></textarea>
      
      <p class="custom-hint" data-i18n-html="app.modals.customQuestion.hint">
        ğŸ’¡ <strong>Dica:</strong> SÃª especÃ­fico/a e claro/a. Esta pergunta aparecerÃ¡ no questionÃ¡rio e no relatÃ³rio de compatibilidade.
      </p>
    </div>
    
    <div class="custom-modal-footer">
      <button class="btn-cancel" onclick="closeCustomQuestionModal()" data-i18n="app.modals.customQuestion.cancel">âŒ Cancelar</button>
      <button class="btn-add" onclick="addCustomQuestion()" data-i18n="app.modals.customQuestion.add">âœ… Adicionar</button>
    </div>
  </div>
</div>

<!-- Load Answers Modal -->
<div class="modal-overlay" id="loadAnswersModal">
  <div class="custom-question-modal">
    <div class="custom-modal-header">
      <h2 data-i18n="app.modals.loadAnswers.title">ğŸ“‚ Carregar Respostas Guardadas</h2>
      <button class="modal-close" onclick="closeLoadModal()">âœ•</button>
    </div>
    
    <div class="custom-modal-body">
      <label for="loadAnswersFile" data-i18n="app.modals.loadAnswers.fileLabel">ğŸ“ Seleciona o ficheiro .q4c:</label>
      <input type="file" id="loadAnswersFile" accept=".q4c" style="width: 100%; padding: 10px; margin: 10px 0; border: 2px dashed #d63384; border-radius: 10px; cursor: pointer;">
      
      <label for="loadAnswersCode" data-i18n="app.modals.loadAnswers.codeLabel">ğŸ”‘ CÃ³digo de seguranÃ§a:</label>
      <input type="password" id="loadAnswersCode" data-i18n-placeholder="app.modals.loadAnswers.codePlaceholder" placeholder="CÃ³digo usado ao guardar..." style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 10px;">
      
      <p class="custom-hint" data-i18n-html="app.modals.loadAnswers.hint">
        ğŸ’¡ <strong>Como funciona:</strong> Carrega o ficheiro .q4c que guardaste anteriormente para continuar a responder de onde paraste. As tuas respostas aparecerÃ£o automaticamente!
      </p>
    </div>
    
    <div class="custom-modal-footer">
      <button class="btn-cancel" onclick="closeLoadModal()" data-i18n="app.modals.loadAnswers.cancel">âŒ Cancelar</button>
      <button class="btn-add" onclick="loadAnswersFromFile()" data-i18n="app.modals.loadAnswers.load">âœ… Carregar</button>
    </div>
  </div>
</div>

<!-- Import Partner Questions Modal -->
<div class="modal-overlay" id="importQuestionsModal">
  <div class="custom-question-modal">
    <div class="custom-modal-header">
      <h2 data-i18n="app.modals.importQuestions.title">ğŸ“¥ Importar Perguntas do Parceiro</h2>
      <button class="modal-close" onclick="closeImportModal()">âœ•</button>
    </div>
    
    <div class="custom-modal-body">
      <label for="importQuestionsFile" data-i18n="app.modals.importQuestions.fileLabel">ğŸ“ Ficheiro .q4c do parceiro:</label>
      <input type="file" id="importQuestionsFile" accept=".q4c" style="width: 100%; padding: 10px; margin: 10px 0; border: 2px dashed #28a745; border-radius: 10px; cursor: pointer;">
      
      <label for="importQuestionsCode" data-i18n="app.modals.importQuestions.codeLabel">ğŸ”‘ CÃ³digo de seguranÃ§a dele/a:</label>
      <input type="password" id="importQuestionsCode" data-i18n-placeholder="app.modals.importQuestions.codePlaceholder" placeholder="CÃ³digo que ele/a usou..." style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 10px;">
      
      <p class="custom-hint" data-i18n-html="app.modals.importQuestions.hint">
        ğŸ’¡ <strong>Para que serve:</strong> Se o teu parceiro/a criou perguntas personalizadas, carrega o ficheiro .q4c dele/a aqui. As perguntas custom aparecerÃ£o automaticamente para tu poderes responder tambÃ©m!
      </p>
      
      <div style="background: #d1ecf1; border-left: 4px solid #17a2b8; padding: 12px; margin-top: 15px; border-radius: 5px;" data-i18n-html="app.modals.importQuestions.steps">
        <strong>ğŸ“‹ Passo a passo:</strong><br>
        1. Parceiro cria perguntas custom<br>
        2. Parceiro guarda ficheiro .q4c<br>
        3. Parceiro envia-te o ficheiro<br>
        4. Tu carregas aqui â†’ Perguntas aparecem!
      </div>
    </div>
    
    <div class="custom-modal-footer">
      <button class="btn-cancel" onclick="closeImportModal()" data-i18n="app.modals.importQuestions.cancel">âŒ Cancelar</button>
      <button class="btn-add" onclick="importPartnerQuestions()" data-i18n="app.modals.importQuestions.import">âœ… Importar</button>
    </div>
  </div>
</div>

<!-- Support Banner -->
<div style="max-width: 1200px; margin: 40px auto 20px; padding: 0 20px;">
  <div id="supportBanner"></div>
</div>

<!-- Footer -->
<footer style="margin-top: 30px; padding: 30px 20px; background: rgba(255,255,255,0.9); border-top: 2px solid #d63384; text-align: center;">
  <div style="max-width: 1200px; margin: 0 auto;">
    <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-bottom: 20px;">
      <a href="pages/sobre.html" style="color: #d63384; text-decoration: none; font-weight: 600;">Sobre</a>
      <a href="pages/faq.html" style="color: #d63384; text-decoration: none; font-weight: 600;">FAQ</a>
      <a href="pages/apoiar.html" style="color: #d63384; text-decoration: none; font-weight: 600;">Apoiar</a>
      <a href="pages/termos.html" style="color: #d63384; text-decoration: none; font-weight: 600;">Termos de Uso</a>
      <a href="pages/privacidade.html" style="color: #d63384; text-decoration: none; font-weight: 600;">Privacidade</a>
    </div>
    <p style="color: #6c757d; font-size: 0.9em; margin: 10px 0;">
      ğŸ’• Quest4Couple - Descubram-se juntos
    </p>
    <p style="color: #999; font-size: 0.8em;">
      Â© 2025 Quest4Couple. Todos os direitos reservados.
    </p>  </div>
</footer>

<!-- Support Banner Script -->
<script src="support-banner.js"></script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<!-- Firebase Config & Auth -->
<script src="js/firebase-config.js"></script>
<script src="js/firestore-sync.js"></script>
<script src="js/analytics.js"></script>
<script src="js/profile-completion.js"></script>
<script src="js/notifications.js"></script>

<!-- JavaScript Modules -->
<script src="js/customQuestions.js?v=20241120"></script>
<script src="js/invertMatching.js?v=20241120"></script>
<script src="js/loadAnswers.js?v=20241120"></script>
<script src="js/pack-collapse.js?v=20241120"></script>
<script src="js/app.js?v=20241120"></script>
<script src="js/rendering.js?v=20241120"></script>
<script src="js/storage.js?v=20241127"></script>
<script src="js/comparison.js?v=20241120"></script>

<!-- Auth Check (Permitir visualizaÃ§Ã£o sem login) -->
<script>
  let isUserAuthenticated = false;
  
  // Verificar se user estÃ¡ autenticado
  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      // User NÃƒO autenticado - pode VER mas nÃ£o pode RESPONDER
      console.warn('âš ï¸ Modo visualizaÃ§Ã£o: User nÃ£o autenticado');
      isUserAuthenticated = false;
      
      // Atualizar header para modo nÃ£o autenticado
      const userSection = document.querySelector('.user-section');
      if (userSection) {
        userSection.innerHTML = `
          <div style="background: rgba(255, 193, 7, 0.1); border: 2px solid rgba(255, 193, 7, 0.5); border-radius: 10px; padding: 12px 20px; display: flex; align-items: center; gap: 10px; margin-right: 15px;">
            <span style="font-size: 1.2em;">âš ï¸</span>
            <span style="color: #856404; font-weight: 600;">Modo VisualizaÃ§Ã£o</span>
          </div>
          <button class="btn btn-login" onclick="window.location.href='auth.html'" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            ğŸ” Fazer Login para Responder
          </button>
        `;
      }
      
      // Desabilitar todos os inputs de resposta
      disableAnswerInputs();
      
      // Mostrar banner informativo
      showLoginBanner();
      
    } else {
      // User AUTENTICADO - pode ver E responder
      console.log('âœ… User autenticado:', user.email);
      isUserAuthenticated = true;
      
      // Atualizar nome do user no header
      const currentUserName = document.getElementById('currentUserName');
      if (currentUserName) {
        currentUserName.textContent = user.displayName || user.email.split('@')[0];
      }
      
      // â­ VERIFICAR SE PERFIL ESTÃ COMPLETO
      if (window.profileCompletion) {
        try {
          const userDoc = await db.collection('users').doc(user.uid).get();
          const userProfile = userDoc.exists ? userDoc.data() : {};
          
          if (!window.profileCompletion.isProfileComplete(userProfile)) {
            console.log('âš ï¸ Perfil incompleto - solicitando dados em falta');
            await window.profileCompletion.checkAndRequestProfileCompletion(userProfile, (updatedData) => {
              console.log('âœ… Perfil completado:', updatedData);
            });
          }
        } catch (profileError) {
          console.warn('âš ï¸ Erro ao verificar perfil:', profileError);
        }
      }
      
      // Habilitar inputs de resposta
      enableAnswerInputs();
      
      // Remover banner de login (se existir)
      removeLoginBanner();
    }
  });
  
  // Desabilitar inputs quando nÃ£o autenticado
  function disableAnswerInputs() {
    // Desabilitar radios
    document.querySelectorAll('input[type="radio"]').forEach(input => {
      input.disabled = true;
      input.style.cursor = 'not-allowed';
    });
    
    // Desabilitar textareas
    document.querySelectorAll('textarea').forEach(textarea => {
      textarea.disabled = true;
      textarea.placeholder = 'ğŸ”’ FaÃ§a login para adicionar comentÃ¡rios';
      textarea.style.cursor = 'not-allowed';
      textarea.style.background = '#f5f5f5';
    });
  }
  
  // Habilitar inputs quando autenticado
  function enableAnswerInputs() {
    // Habilitar radios
    document.querySelectorAll('input[type="radio"]').forEach(input => {
      input.disabled = false;
      input.style.cursor = 'pointer';
    });
    
    // Habilitar textareas
    document.querySelectorAll('textarea').forEach(textarea => {
      textarea.disabled = false;
      textarea.placeholder = 'ComentÃ¡rio (opcional)...';
      textarea.style.cursor = 'text';
      textarea.style.background = 'white';
    });
  }
  
  // Mostrar banner informativo
  function showLoginBanner() {
    // Verificar se banner jÃ¡ existe
    if (document.getElementById('loginBanner')) return;
    
    const banner = document.createElement('div');
    banner.id = 'loginBanner';
    banner.style.cssText = `
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 20px;
      animation: slideUp 0.5s ease-out;
      max-width: 90%;
    `;
    
    banner.innerHTML = `
      <span style="font-size: 2em;">ğŸ’¡</span>
      <div>
        <div style="font-weight: 700; font-size: 1.1em; margin-bottom: 5px;">
          EstÃ¡ em modo visualizaÃ§Ã£o
        </div>
        <div style="font-size: 0.9em; opacity: 0.95;">
          FaÃ§a login para responder e guardar as suas respostas
        </div>
      </div>
      <button onclick="window.location.href='auth.html'" style="
        background: white;
        color: #667eea;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
        white-space: nowrap;
      " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
        ğŸ” Fazer Login
      </button>
      <button onclick="this.parentElement.remove()" style="
        background: transparent;
        border: none;
        color: white;
        font-size: 1.5em;
        cursor: pointer;
        padding: 0;
        margin-left: -10px;
      ">Ã—</button>
    `;
    
    document.body.appendChild(banner);
    
    // Adicionar animaÃ§Ã£o
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateX(-50%) translateY(100px);
        }
        to {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
      }
    `;
    document.head.appendChild(style);
  }
  
  // Remover banner
  function removeLoginBanner() {
    const banner = document.getElementById('loginBanner');
    if (banner) {
      banner.remove();
    }
  }
  
  // FunÃ§Ã£o de logout
  function logout() {
    if (confirm('Tem certeza que deseja sair?')) {
      auth.signOut().then(() => {
        console.log('âœ… Logout realizado');
        window.location.href = 'auth.html';
      }).catch((error) => {
        console.error('âŒ Erro ao fazer logout:', error);
        alert('Erro ao sair. Tente novamente.');
      });
    }
  }
  
  // Interceptar tentativas de resposta sem login
  document.addEventListener('click', function(e) {
    if (!isUserAuthenticated && (e.target.type === 'radio' || e.target.tagName === 'TEXTAREA')) {
      e.preventDefault();
      if (confirm('âš ï¸ Precisa fazer login para responder aos questionÃ¡rios.\n\nQuer ir para a pÃ¡gina de login agora?')) {
        window.location.href = 'auth.html';
      }
    }
  });
</script>

<!-- âœ… Service Worker Cleanup - ForÃ§a atualizaÃ§Ã£o no Chrome mobile -->
<script>
  // âœ… CORRIGIDO: Executar cleanup de forma silenciosa sem recarregar pÃ¡gina
  (function() {
    // Marcar que cleanup foi executado (usar flag mais persistente)
    const CLEANUP_VERSION = 'v20241120'; // Atualizar esta versÃ£o para forÃ§ar novo cleanup
    const lastCleanup = localStorage.getItem('sw_cleanup_version');
    
    if (lastCleanup === CLEANUP_VERSION) {
      console.log('âœ… Cleanup jÃ¡ executado para versÃ£o:', CLEANUP_VERSION);
      return;
    }
    
    console.log('ğŸ§¹ Executando cleanup de cache e service workers...');
    
    // Verificar e limpar service workers antigos
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        if (registrations.length > 0) {
          console.log('ğŸ§¹ Service Workers encontrados:', registrations.length);
          
          // Desregistar todos os service workers (silenciosamente)
          Promise.all(
            registrations.map(reg => reg.unregister())
          ).then(function() {
            console.log('âœ… Todos os Service Workers desregistados');
            localStorage.setItem('sw_cleanup_version', CLEANUP_VERSION);
          });
        } else {
          console.log('âœ… Nenhum Service Worker ativo');
          localStorage.setItem('sw_cleanup_version', CLEANUP_VERSION);
        }
      });
    } else {
      localStorage.setItem('sw_cleanup_version', CLEANUP_VERSION);
    }
    
    // Limpar cache do browser programaticamente (silenciosamente)
    if ('caches' in window) {
      caches.keys().then(function(names) {
        if (names.length > 0) {
          console.log('ğŸ§¹ Limpando', names.length, 'caches...');
          Promise.all(
            names.map(name => caches.delete(name))
          ).then(function() {
            console.log('âœ… Todo o cache limpo');
          });
        }
      });
    }
  })();
</script>

<!-- Renderizar Support Banner -->
<script>
  // Renderizar banner de apoio
  if (typeof SupportBanner !== 'undefined') {
    SupportBanner.render('supportBanner', false);
  }
</script>

<!-- i18n System -->
<script src="js/i18n.js"></script>

</body>
</html>
